/**
 * @namespace JawsJS core functions. "Field Summary" contains readable properties on the main jaws-object.
 *
 * @property {int} mouse_x  Mouse X position with respect to the canvas-element
 * @property {int} mouse_y  Mouse Y position with respect to the canvas-element
 * @property {canvas} canvas  The detected/created canvas-element used for the game
 * @property {context} context  The detected/created canvas 2D-context, used for all draw-operations
 * @property {int} width  Width of the canvas-element
 * @property {int} height  Height of the canvas-element
 *
 *
 * @example
 * Jaws, a HTML5 canvas/javascript 2D game development framework
 *
 * Homepage:      http://jawsjs.com/
 * Source:        http://github.com/ippa/jaws/
 * Documentation: http://jawsjs.com/docs/
 *
 * Works with:  Chrome 6.0+, Firefox 3.6+, 4+, IE 9+
 * License: LGPL - http://www.gnu.org/licenses/lgpl.html
 *
 * Jaws uses the "module pattern".
 * Adds 1 global, <b>jaws</b>, so plays nice with all other JS libs.
 *
 * Formating guide:
 *   jaws.oneFunction()
 *   jaws.one_variable = 1
 *   new jaws.OneConstructor
 *
 * Have fun!
 *
 * ippa.
 *
 */

/*!
 * Lo-Dash v0.7.0 <http://lodash.com>
 * Copyright 2012 John-David Dalton <http://allyoucanleet.com/>
 * Based on Underscore.js 1.3.3, copyright 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
 * <http://documentcloud.github.com/underscore>
 * Available under MIT license <http://lodash.com/license>
 */

define("jaws",[],function(){var jaws=function(e){function r(t){e.mouse_x=t.pageX||t.clientX,e.mouse_y=t.pageY||t.clientX;var n=e.canvas?e.canvas:e.dom;e.mouse_x-=n.offsetLeft,e.mouse_y-=n.offsetTop}var t,n;return e.title=function(e){return e?t.innerHTML=e:t.innerHTML},e.unpack=function(){var t=["Sprite","SpriteList","Animation","Viewport","SpriteSheet","Parallax","TileMap","Rect","pressed"];t.forEach(function(t,n,r){window[t]?e.log(t+"already exists in global namespace"):window[t]=e[t]})},e.log=function(e,t){n&&(e+="<br />",t?n.innerHTML=n.innerHTML.toString()+e:n.innerHTML=e)},e.init=function(i){t=document.getElementsByTagName("title")[0],e.url_parameters=e.getUrlParameters(),n=document.getElementById("jaws-log"),e.url_parameters.debug&&(n||(n=document.createElement("div"),n.id="jaws-log",n.style.cssText="overflow: auto; color: #aaaaaa; width: 300px; height: 150px; margin: 40px auto 0px auto; padding: 5px; border: #444444 1px solid; clear: both; font: 10px verdana; text-align: left;",document.body.appendChild(n))),e.canvas=document.getElementsByTagName("canvas")[0],e.canvas||(e.dom=document.getElementById("canvas")),e.canvas?e.context=e.canvas.getContext("2d"):e.dom?e.dom.style.position="relative":(e.canvas=document.createElement("canvas"),e.canvas.width=i.width,e.canvas.height=i.height,e.context=e.canvas.getContext("2d"),document.body.appendChild(e.canvas)),e.width=e.canvas?e.canvas.width:e.dom.offsetWidth,e.height=e.canvas?e.canvas.height:e.dom.offsetHeight,e.mouse_x=0,e.mouse_y=0,window.addEventListener("mousemove",r)},e.start=function(t,n,r){function s(t){e.context&&n.loading_screen&&(e.context.save(),e.context.fillStyle="black",e.context.fillRect(0,0,e.width,e.height),e.context.textAlign="center",e.context.fillStyle="white",e.context.font="15px terminal",e.context.fillText("Loading",e.width/2,e.height/2-30),e.context.font="bold 30px terminal",e.context.fillText(t+"%",e.width/2,e.height/2),e.context.restore())}function o(t,n){e.log(n+"%: "+t,!0),s(n)}function u(t){e.log("Error loading: "+t,!0)}function a(){e.log("all assets loaded",!0),e.switchGameState(t||window,{fps:i},r)}n||(n={});var i=n.fps||60;n.loading_screen===undefined&&(n.loading_screen=!0),n.width||(n.width=500),n.height||(n.height=300),e.init(n),s(0),e.log("setupInput()",!0),e.setupInput(),e.log("assets.loadAll()",!0),e.assets.length()>0?e.assets.loadAll({onload:o,onerror:u,onfinish:a}):a()},e.switchGameState=function(t,n,r){var i=n&&n.fps||e.game_loop&&e.game_loop.fps||60;e.game_loop&&e.game_loop.stop(),e.clearKeyCallbacks(),e.isFunction(t)&&(t=new t),e.previous_game_state=e.game_state,e.game_state=t,e.game_loop=new e.GameLoop(t,{fps:i},r),e.game_loop.start()},e.imageToCanvas=function(e){var t=document.createElement("canvas");t.src=e.src,t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0,e.width,e.height),t},e.forceArray=function(e){return Array.isArray(e)?e:[e]},e.clear=function(){e.context.clearRect(0,0,e.width,e.height)},e.isImage=function(e){return Object.prototype.toString.call(e)==="[object HTMLImageElement]"},e.isCanvas=function(e){return Object.prototype.toString.call(e)==="[object HTMLCanvasElement]"},e.isDrawable=function(t){return e.isImage(t)||e.isCanvas(t)},e.isString=function(e){return typeof e=="string"},e.isArray=function(e){return e===undefined?!1:e.constructor.toString().indexOf("Array")!=-1},e.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"},e.isOutsideCanvas=function(t){return t.x<0||t.y<0||t.x>e.width||t.y>e.height},e.forceInsideCanvas=function(t){t.x<0&&(t.x=0),t.x>e.width&&(t.x=e.width),t.y<0&&(t.y=0),t.y>e.height&&(t.y=e.height)},e.getUrlParameters=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++)t=n[r].split("="),e.push(t[0]),e[t[0]]=t[1];return e},e}(jaws||{}),jaws=function(e){function u(e){t={}}function a(e){event=e?e:window.event;var r=n[event.keyCode];t[r]=!1,i[r]&&(i[r](r),e.preventDefault()),d[r]&&e.preventDefault()}function f(e){event=e?e:window.event;var i=n[event.keyCode];t[i]=!0,r[i]&&(r[i](i),e.preventDefault()),d[i]&&e.preventDefault()}function l(e){event=e?e:window.event;var n=s[event.button];navigator.appName=="Microsoft Internet Explorer"&&(n=o[event.button]),t[n]=!0,r[n]&&(r[n](n),e.preventDefault())}function c(e){event=e?e:window.event;var n=s[event.button];navigator.appName=="Microsoft Internet Explorer"&&(n=o[event.button]),t[n]=!1,i[n]&&(i[n](n),e.preventDefault())}function h(n){event=n?n:window.event,t.left_mouse_button=!0,e.mouse_x=n.touches[0].pageX-e.canvas.offsetLeft,e.mouse_y=n.touches[0].pageY-e.canvas.offsetTop}function p(n){event=n?n:window.event,t.left_mouse_button=!1,e.mouse_x=undefined,e.mouse_y=undefined}var t={},n=[],r=[],i=[],s=[],o=[];e.setupInput=function(){var e=[];e[8]="backspace",e[9]="tab",e[13]="enter",e[16]="shift",e[17]="ctrl",e[18]="alt",e[19]="pause",e[20]="capslock",e[27]="esc",e[32]="space",e[33]="pageup",e[34]="pagedown",e[35]="end",e[36]="home",e[37]="left",e[38]="up",e[39]="right",e[40]="down",e[45]="insert",e[46]="delete",e[91]="leftwindowkey",e[92]="rightwindowkey",e[93]="selectkey",e[106]="multiply",e[107]="add",e[109]="subtract",e[110]="decimalpoint",e[111]="divide",e[144]="numlock",e[145]="scrollock",e[186]="semicolon",e[187]="equalsign",e[188]="comma",e[189]="dash",e[190]="period",e[191]="forwardslash",e[192]="graveaccent",e[219]="openbracket",e[220]="backslash",e[221]="closebracket",e[222]="singlequote";var t=[];t[0]="left_mouse_button",t[1]="center_mouse_button",t[2]="right_mouse_button";var r=[];r[1]="left_mouse_button",r[2]="right_mouse_button",r[4]="center_mouse_button",s=t,o=r;var i=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],d=["f1","f2","f3","f4","f5","f6","f7","f8","f9"],v=["0","1","2","3","4","5","6","7","8","9"],m=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];for(var g=0;v[g];g++)e[48+g]=v[g];for(var g=0;m[g];g++)e[65+g]=m[g];for(var g=0;i[g];g++)e[96+g]=i[g];for(var g=0;d[g];g++)e[112+g]=d[g];n=e,window.addEventListener("keydown",f),window.addEventListener("keyup",a),window.addEventListener("mousedown",l,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("touchstart",h,!1),window.addEventListener("touchend",p,!1),window.addEventListener("blur",u,!1),document.oncontextmenu=function(){return!1}};var d=[];return e.preventDefaultKeys=function(e){e.forEach(function(e,t){d[e]=!0})},e.pressed=function(e){return t[e]},e.on_keydown=function(t,n){if(e.isArray(t))for(var i=0;t[i];i++)r[t[i]]=n;else r[t]=n},e.on_keyup=function(t,n){if(e.isArray(t))for(var r=0;t[r];r++)i[t[r]]=n;else i[t]=n},e.clearKeyCallbacks=function(){i=[],r=[]},e}(jaws||{}),jaws=function(e){function t(t){canvas=e.isImage(t)?e.imageToCanvas(t):t;var n=canvas.getContext("2d"),r=n.getImageData(0,0,canvas.width,canvas.height),i=r.data;for(var s=0;s<i.length;s+=4)i[s]==255&&i[s+1]==0&&i[s+2]==255&&(i[s+3]=0);return n.putImageData(r,0,0),canvas}return e.Assets=function(){if(!(this instanceof arguments.callee))return new arguments.callee;this.loaded=[],this.loading=[],this.src_list=[],this.data=[],this.bust_cache=!1,this.image_to_canvas=!0,this.fuchia_to_transparent=!0,this.root="",this.file_type={},this.file_type.json="json",this.file_type.wav="audio",this.file_type.mp3="audio",this.file_type.ogg="audio",this.file_type.png="image",this.file_type.jpg="image",this.file_type.jpeg="image",this.file_type.gif="image",this.file_type.bmp="image",this.file_type.tiff="image";var r=this;this.length=function(){return this.src_list.length},this.get=function(t){if(e.isArray(t))return t.map(function(e){return r.data[e]});if(this.loaded[t])return this.data[t];e.log("No such asset: "+t,!0)},this.isLoading=function(e){return this.loading[e]},this.isLoaded=function(e){return this.loaded[e]},this.getPostfix=function(e){return postfix_regexp=/\.([a-zA-Z0-9]+)/,postfix_regexp.exec(e)[1]},this.getType=function(e){var t=this.getPostfix(e);return this.file_type[t]?this.file_type[t]:t},this.add=function(t){if(e.isArray(t))for(var n=0;t[n];n++)this.add(t[n]);else this.src_list.push(t);return this},this.loadAll=function(e){this.load_count=0,this.error_count=0,this.onload=e.onload,this.onerror=e.onerror,this.onfinish=e.onfinish;for(i=0;this.src_list[i];i++)this.load(this.src_list[i])},this.getOrLoad=function(e,t,n){this.data[e]?t():this.load(e,t,n)},this.load=function(e,t,n){var r={};r.src=e,r.onload=t,r.onerror=n,this.loading[e]=!0;var i=this.root+r.src;this.bust_cache&&(i+="?"+parseInt(Math.random()*1e7));switch(this.getType(r.src)){case"image":r.image=new Image,r.image.asset=r,r.image.onload=this.assetLoaded,r.image.onerror=this.assetError,r.image.src=i;break;case"audio":r.audio=new Audio(i),r.audio.asset=r,this.data[r.src]=r.audio,r.audio.addEventListener("canplay",this.assetLoaded,!1),r.audio.addEventListener("error",this.assetError,!1),r.audio.load();break;default:var s=new XMLHttpRequest;s.asset=r,s.onreadystatechange=this.assetLoaded,s.open("GET",i,!0),s.send(null)}},this.assetLoaded=function(n){var i=this.asset,s=i.src,o=r.getType(i.src);r.loaded[s]=!0,r.loading[s]=!1;if(o=="json"){if(this.readyState!=4)return;r.data[i.src]=JSON.parse(this.responseText)}else if(o=="image"){var u=r.image_to_canvas?e.imageToCanvas(i.image):i.image;r.fuchia_to_transparent&&r.getPostfix(i.src)=="bmp"&&(u=t(u)),r.data[i.src]=u}else o=="audio"&&(i.audio.removeEventListener("canplay",r.assetLoaded,!1),r.data[i.src]=i.audio);r.load_count++,r.processCallbacks(i,!0)},this.assetError=function(e){var t=this.asset;r.error_count++,r.processCallbacks(t,!1)},this.processCallbacks=function(e,t){var n=parseInt((r.load_count+r.error_count)/r.src_list.length*100);t?(r.onload&&r.onload(e.src,n),e.onload&&e.onload()):(r.onerror&&r.onerror(e.src,n),e.onerror&&e.onerror(e)),n==100&&(r.onfinish&&r.onfinish(),r.onload=null,r.onerror=null,r.onfinish=null)}},e.assets=new e.Assets,e}(jaws||{}),jaws=function(e){function t(e){this.size=e,this.values=new Array(this.size),this.value,this.add=function(e){if(this.values.length>this.size){this.values.splice(0,1),this.value=0;for(var t=0;this.values[t];t++)this.value+=this.values[t];this.value=this.value/this.size}return this.values.push(e),this},this.get=function(){return parseInt(this.value)}}return window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,16.666)}}(),e.GameLoop=function(r,i,s){if(!(this instanceof arguments.callee))return new arguments.callee(r,i);this.tick_duration=0,this.fps=0,this.ticks=0;var o,u=!1,a=!1,f=this,l=new t(20);this.runtime=function(){return this.last_tick-this.first_tick},this.start=function(){e.log("game loop start",!0),this.first_tick=(new Date).getTime(),this.current_tick=(new Date).getTime(),this.last_tick=(new Date).getTime(),r.setup&&r.setup(s),step_delay=1e3/i.fps,i.fps==60?requestAnimFrame(this.loop):o=setInterval(this.loop,step_delay),e.log("game loop loop",!0)},this.loop=function(){f.current_tick=(new Date).getTime(),f.tick_duration=f.current_tick-f.last_tick,f.fps=l.add(1e3/f.tick_duration).get(),!a&&!u&&(r.update&&r.update(),r.draw&&r.draw(),f.ticks++),i.fps==60&&!a&&requestAnimFrame(f.loop),f.last_tick=f.current_tick},this.pause=function(){u=!0},this.unpause=function(){u=!1},this.stop=function(){o&&clearInterval(o),a=!0}},e}(jaws||{}),jaws=function(e){return e.Rect=function(t,n,r,i){if(!(this instanceof arguments.callee))return new arguments.callee(t,n,r,i);this.x=t,this.y=n,this.width=r,this.height=i,this.right=t+r,this.bottom=n+i},e.Rect.prototype.getPosition=function(){return[this.x,this.y]},e.Rect.prototype.move=function(e,t){return this.x+=e,this.y+=t,this.right+=e,this.bottom+=t,this},e.Rect.prototype.moveTo=function(e,t){return this.x=e,this.y=t,this.right=this.x+this.width,this.bottom=this.y+this.height,this},e.Rect.prototype.resize=function(e,t){return this.width+=e,this.height+=t,this.right=this.x+this.width,this.bottom=this.y+this.height,this},e.Rect.prototype.resizeTo=function(e,t){return this.width=e,this.height=t,this.right=this.x+this.width,this.bottom=this.y+this.height,this},e.Rect.prototype.draw=function(){return e.context.strokeStyle="red",e.context.strokeRect(this.x,this.y,this.width,this.height),this},e.Rect.prototype.collidePoint=function(e,t){return e>=this.x&&e<=this.right&&t>=this.y&&t<=this.bottom},e.Rect.prototype.collideRect=function(e){return(this.x>=e.x&&this.x<=e.right||e.x>=this.x&&e.x<=this.right)&&(this.y>=e.y&&this.y<=e.bottom||e.y>=this.y&&e.y<=this.bottom)},e.Rect.prototype.toString=function(){return"[Rect "+this.x+", "+this.y+", "+this.width+", "+this.height+"]"},e}(jaws||{});typeof module!="undefined"&&"exports"in module&&(module.exports=jaws.Rect);var jaws=function(jaws){return jaws.Sprite=function(t){if(!(this instanceof arguments.callee))return new arguments.callee(t);this.options=t,this.set(t),t.context?this.context=t.context:t.dom&&(this.dom=t.dom,this.createDiv()),!t.context&&!t.dom&&(jaws.context?this.context=jaws.context:(this.dom=jaws.dom,this.createDiv()))},jaws.Sprite.prototype.set=function(e){return this.scale_x=this.scale_y=e.scale||1,this.x=e.x||0,this.y=e.y||0,this.alpha=e.alpha===undefined?1:e.alpha,this.angle=e.angle||0,this.flipped=e.flipped||!1,this.anchor(e.anchor||"top_left"),e.anchor_x!==undefined&&(this.anchor_x=e.anchor_x),e.anchor_y!==undefined&&(this.anchor_y=e.anchor_y),e.image&&this.setImage(e.image),this.image_path=e.image,e.scale_image&&this.scaleImage(e.scale_image),this.cacheOffsets(),this},jaws.Sprite.prototype.clone=function(object){var constructor=this._constructor?eval(this._constructor):this.constructor,new_sprite=new constructor(this.attributes());return new_sprite._constructor=this._constructor||this.constructor.name,new_sprite},jaws.Sprite.prototype.setImage=function(e){var t=this;return jaws.isDrawable(e)?(this.image=e,this.cacheOffsets()):(jaws.assets.isLoaded(e)?(this.image=jaws.assets.get(e),this.cacheOffsets()):jaws.assets.load(e,function(){t.image=jaws.assets.get(e),t.cacheOffsets()}),this)},jaws.Sprite.prototype.flip=function(){return this.flipped=this.flipped?!1:!0,this},jaws.Sprite.prototype.flipTo=function(e){return this.flipped=e,this},jaws.Sprite.prototype.rotate=function(e){return this.angle+=e,this},jaws.Sprite.prototype.rotateTo=function(e){return this.angle=e,this},jaws.Sprite.prototype.moveTo=function(e,t){return this.x=e,this.y=t,this},jaws.Sprite.prototype.move=function(e,t){return e&&(this.x+=e),t&&(this.y+=t),this},jaws.Sprite.prototype.scale=function(e){return this.scale_x*=e,this.scale_y*=e,this.cacheOffsets()},jaws.Sprite.prototype.scaleTo=function(e){return this.scale_x=this.scale_y=e,this.cacheOffsets()},jaws.Sprite.prototype.scaleWidth=function(e){return this.scale_x*=e,this.cacheOffsets()},jaws.Sprite.prototype.scaleHeight=function(e){return this.scale_y*=e,this.cacheOffsets()},jaws.Sprite.prototype.setX=function(e){return this.x=e,this},jaws.Sprite.prototype.setY=function(e){return this.y=e,this},jaws.Sprite.prototype.setTop=function(e){return this.y=e+this.top_offset,this},jaws.Sprite.prototype.setBottom=function(e){return this.y=e-this.bottom_offset,this},jaws.Sprite.prototype.setLeft=function(e){return this.x=e+this.left_offset,this},jaws.Sprite.prototype.setRight=function(e){return this.x=e-this.right_offset,this},jaws.Sprite.prototype.setWidth=function(e){return this.scale_x=e/this.image.width,this.cacheOffsets()},jaws.Sprite.prototype.setHeight=function(e){return this.scale_y=e/this.image.height,this.cacheOffsets()},jaws.Sprite.prototype.resize=function(e,t){return this.scale_x=(this.width+e)/this.image.width,this.scale_y=(this.height+t)/this.image.height,this.cacheOffsets()},jaws.Sprite.prototype.resizeTo=function(e,t){return this.scale_x=e/this.image.width,this.scale_y=t/this.image.height,this.cacheOffsets()},jaws.Sprite.prototype.anchor=function(e){var t={top_left:[0,0],left_top:[0,0],center_left:[0,.5],left_center:[0,.5],bottom_left:[0,1],left_bottom:[0,1],top_center:[.5,0],center_top:[.5,0],center_center:[.5,.5],center:[.5,.5],bottom_center:[.5,1],center_bottom:[.5,1],top_right:[1,0],right_top:[1,0],center_right:[1,.5],right_center:[1,.5],bottom_right:[1,1],right_bottom:[1,1]};if(a=t[e])this.anchor_x=a[0],this.anchor_y=a[1],this.image&&this.cacheOffsets();return this},jaws.Sprite.prototype.cacheOffsets=function(){if(!this.image)return;return this.width=this.image.width*this.scale_x,this.height=this.image.height*this.scale_y,this.left_offset=this.width*this.anchor_x,this.top_offset=this.height*this.anchor_y,this.right_offset=this.width*(1-this.anchor_x),this.bottom_offset=this.height*(1-this.anchor_y),this.cached_rect&&this.cached_rect.resizeTo(this.width,this.height),this},jaws.Sprite.prototype.rect=function(){return this.cached_rect||(this.cached_rect=new jaws.Rect(this.x,this.top,this.width,this.height)),this.cached_rect.moveTo(this.x-this.left_offset,this.y-this.top_offset),this.cached_rect},jaws.Sprite.prototype.createDiv=function(){this.div=document.createElement("div"),this.div.style.position="absolute",this.image&&(this.div.style.width=this.image.width+"px",this.div.style.height=this.image.height+"px",this.image.toDataURL?this.div.style.backgroundImage="url("+this.image.toDataURL()+")":this.div.style.backgroundImage="url("+this.image.src+")"),this.dom&&this.dom.appendChild(this.div),this.updateDiv()},jaws.Sprite.prototype.updateDiv=function(){this.div.style.left=this.x+"px",this.div.style.top=this.y+"px";var e="";return e+="rotate("+this.angle+"deg) ",this.flipped?e+="scale(-"+this.scale_x+","+this.scale_y+")":e+="scale("+this.scale_x+","+this.scale_y+")",this.div.style.MozTransform=e,this.div.style.WebkitTransform=e,this.div.style.OTransform=e,this.div.style.msTransform=e,this.div.style.transform=e,this},jaws.Sprite.prototype.draw=function(){return this.image?this.dom?this.updateDiv():(this.context.save(),this.context.translate(this.x,this.y),this.angle!=0&&jaws.context.rotate(this.angle*Math.PI/180),this.flipped&&this.context.scale(-1,1),this.context.globalAlpha=this.alpha,this.context.translate(-this.left_offset,-this.top_offset),this.context.drawImage(this.image,0,0,this.width,this.height),this.context.restore(),this):this},jaws.Sprite.prototype.scaleImage=function(e){if(!this.image)return;return this.setImage(jaws.gfx.retroScaleImage(this.image,e)),this},jaws.Sprite.prototype.asCanvasContext=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");return t.mozImageSmoothingEnabled=jaws.context.mozImageSmoothingEnabled,t.drawImage(this.image,0,0,this.width,this.height),t},jaws.Sprite.prototype.asCanvas=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");return t.mozImageSmoothingEnabled=jaws.context.mozImageSmoothingEnabled,t.drawImage(this.image,0,0,this.width,this.height),e},jaws.Sprite.prototype.toString=function(){return"[Sprite "+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width+", "+this.height+"]"},jaws.Sprite.prototype.attributes=function(){var e=this.options;return e._constructor=this._constructor||"jaws.Sprite",e.x=parseFloat(this.x.toFixed(2)),e.y=parseFloat(this.y.toFixed(2)),e.image=this.image_path,e.alpha=this.alpha,e.flipped=this.flipped,e.angle=parseFloat(this.angle.toFixed(2)),e.scale_x=this.scale_x,e.scale_y=this.scale_y,e.anchor_x=this.anchor_x,e.anchor_y=this.anchor_y,e},jaws.Sprite.prototype.toJSON=function(){return JSON.stringify(this.attributes())},jaws}(jaws||{});typeof module!="undefined"&&"exports"in module&&(module.exports=jaws.Sprite);var jaws=function(jaws){return jaws.SpriteList=function(t){if(!(this instanceof arguments.callee))return new arguments.callee(t);this.sprites=[],this.length=0,t&&this.load(t)},jaws.SpriteList.prototype.at=function(e){return this.sprites[e]},jaws.SpriteList.prototype.concat=function(){return this.sprites.concat.apply(this.sprites,arguments)},jaws.SpriteList.prototype.indexOf=function(e,t){return this.sprites.indexOf(e,t)},jaws.SpriteList.prototype.join=function(e){return this.sprites.join(e)},jaws.SpriteList.prototype.lastIndexOf=function(){return this.sprites.lastIndexOf.apply(this.sprites,arguments)},jaws.SpriteList.prototype.pop=function(){var e=this.sprites.pop();return this.updateLength(),e},jaws.SpriteList.prototype.push=function(){return this.sprites.push.apply(this.sprites,arguments),this.updateLength(),this.length},jaws.SpriteList.prototype.reverse=function(){this.sprites.reverse()},jaws.SpriteList.prototype.shift=function(){var e=this.sprites.shift();return this.updateLength(),e},jaws.SpriteList.prototype.slice=function(e,t){return this.sprites.slice(e,t)},jaws.SpriteList.prototype.sort=function(){this.sprites.sort.apply(this.sprites,arguments)},jaws.SpriteList.prototype.splice=function(){var e=this.sprites.splice.apply(this.sprites,arguments);return this.updateLength(),e},jaws.SpriteList.prototype.unshift=function(){return this.sprites.unshift.apply(this.sprites,arguments),this.updateLength(),this.length},jaws.SpriteList.prototype.updateLength=function(){this.length=this.sprites.length},jaws.SpriteList.prototype.valueOf=function(){return this.toString()},jaws.SpriteList.prototype.filter=function(){return this.sprites.filter.apply(this.sprites,arguments)},jaws.SpriteList.prototype.forEach=function(){this.sprites.forEach.apply(this.sprites,arguments),this.updateLength()},jaws.SpriteList.prototype.every=function(){return this.sprites.every.apply(this.sprites,arguments)},jaws.SpriteList.prototype.map=function(){return this.sprites.map.apply(this.sprites,arguments)},jaws.SpriteList.prototype.reduce=function(){return this.sprites.reduce.apply(this.sprites,arguments)},jaws.SpriteList.prototype.reduceRight=function(){return this.sprites.reduceRight.apply(this.sprites,arguments)},jaws.SpriteList.prototype.some=function(){return this.sprites.some.apply(this.sprites,arguments)},jaws.SpriteList.prototype.isSpriteList=function(){return!0},jaws.SpriteList.prototype.load=function(objects){function parseArray(array){array.forEach(function(data){var constructor=data._constructor?eval(data._constructor):data.constructor;if(jaws.isFunction(constructor)){jaws.log("Creating "+data._constructor+"("+data.toString()+")",!0);var object=new constructor(data);object._constructor=data._constructor||data.constructor.name,that.push(object)}})}var that=this;jaws.isArray(objects)?objects.every(function(e){return e._constructor})?parseArray(objects):this.sprites=objects:jaws.isString(objects)&&(parseArray(JSON.parse(objects)),console.log(objects)),this.updateLength()},jaws.SpriteList.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1),this.updateLength()},jaws.SpriteList.prototype.draw=function(){this.forEach(function(e){e.draw()})},jaws.SpriteList.prototype.drawIf=function(e){this.forEach(function(t){e(t)&&t.draw()})},jaws.SpriteList.prototype.update=function(){this.forEach(function(e){e.update()})},jaws.SpriteList.prototype.updateIf=function(e){this.forEach(function(t){e(t)&&t.update()})},jaws.SpriteList.prototype.deleteIf=function(e){this.removeIf(e)},jaws.SpriteList.prototype.removeIf=function(e){this.sprites=this.filter(function(t){return!e(t)}),this.updateLength()},jaws.SpriteList.prototype.toString=function(){return"[SpriteList "+this.length+" sprites]"},jaws}(jaws||{}),jaws=function(e){function t(e,t,n,r,i){var s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");return o.drawImage(e,t,n,r,i,0,0,s.width,s.height),s}return e.SpriteSheet=function(r){if(!(this instanceof arguments.callee))return new arguments.callee(r);this.image=e.isDrawable(r.image)?r.image:e.assets.data[r.image],this.orientation=r.orientation||"down",this.frame_size=r.frame_size||[32,32],this.frames=[],this.offset=r.offset||0;if(r.scale_image){var i=e.isDrawable(r.image)?r.image:e.assets.get(r.image);this.frame_size[0]*=r.scale_image,this.frame_size[1]*=r.scale_image,r.image=e.gfx.retroScaleImage(i,r.scale_image)}var s=0;if(this.orientation=="down")for(var o=this.offset;o<this.image.width;o+=this.frame_size[0])for(var u=0;u<this.image.height;u+=this.frame_size[1])this.frames.push(t(this.image,o,u,this.frame_size[0],this.frame_size[1]));else for(var u=this.offset;u<this.image.height;u+=this.frame_size[1])for(var o=0;o<this.image.width;o+=this.frame_size[0])this.frames.push(t(this.image,o,u,this.frame_size[0],this.frame_size[1]))},e.SpriteSheet.prototype.toString=function(){return"[SpriteSheet "+this.frames.length+" frames]"},e}(jaws||{}),jaws=function(e){return e.Parallax=function(t){if(!(this instanceof arguments.callee))return new arguments.callee(t);this.scale=t.scale||1,this.repeat_x=t.repeat_x,this.repeat_y=t.repeat_y,this.camera_x=t.camera_x||0,this.camera_y=t.camera_y||0,this.layers=[]},e.Parallax.prototype.draw=function(t){var n,r,i,s;for(var o=0;o<this.layers.length;o++){n=this.layers[o],this.repeat_x?s=-(this.camera_x/n.damping%n.width):s=-(this.camera_x/n.damping),this.repeat_y?n.y=-(this.camera_y/n.damping%n.height):n.y=-(this.camera_y/n.damping),n.x=s;while(n.y<e.height){while(n.x<e.width){n.x+n.width>=0&&n.y+n.height>=0&&n.draw(),n.x=n.x+n.width;if(!this.repeat_x)break}n.y=n.y+n.height,n.x=s;if(!this.repeat_y)break}}},e.Parallax.prototype.addLayer=function(t){var n=new e.ParallaxLayer(t);n.scale(this.scale),this.layers.push(n)},e.Parallax.prototype.toString=function(){return"[Parallax "+this.x+", "+this.y+". "+this.layers.length+" layers]"},e.ParallaxLayer=function(n){if(!(this instanceof arguments.callee))return new arguments.callee(n);this.damping=n.damping||0,e.Sprite.call(this,n)},e.ParallaxLayer.prototype=e.Sprite.prototype,e}(jaws||{}),jaws=function(e){return e.Animation=function(n){if(!(this instanceof arguments.callee))return new arguments.callee(n);this.options=n,this.frames=n.frames||[],this.frame_duration=n.frame_duration||100,this.index=n.index||0,this.loop=n.loop==undefined?1:n.loop,this.bounce=n.bounce||0,this.frame_direction=1,this.frame_size=n.frame_size,this.orientation=n.orientation||"down",this.on_end=n.on_end||null,this.offset=n.offset||0;if(n.scale_image){var r=e.isDrawable(n.sprite_sheet)?n.sprite_sheet:e.assets.get(n.sprite_sheet);this.frame_size[0]*=n.scale_image,this.frame_size[1]*=n.scale_image,n.sprite_sheet=e.gfx.retroScaleImage(r,n.scale_image)}if(n.sprite_sheet){var r=e.isDrawable(n.sprite_sheet)?n.sprite_sheet:e.assets.get(n.sprite_sheet),i=new e.SpriteSheet({image:r,frame_size:this.frame_size,orientation:this.orientation,offset:this.offset});this.frames=i.frames}this.current_tick=(new Date).getTime(),this.last_tick=(new Date).getTime(),this.sum_tick=0},e.Animation.prototype.update=function(){this.current_tick=(new Date).getTime(),this.sum_tick+=this.current_tick-this.last_tick,this.last_tick=this.current_tick,this.sum_tick>this.frame_duration&&(this.index+=this.frame_direction,this.sum_tick=0);if(this.index>=this.frames.length||this.index<0)this.bounce?(this.frame_direction=-this.frame_direction,this.index+=this.frame_direction*2):this.loop?this.index=0:(this.index-=this.frame_direction,this.on_end&&(this.on_end(),this.on_end=null));return this},e.Animation.prototype.slice=function(t,n){var r={};return r.frame_duration=this.frame_duration,r.loop=this.loop,r.bounce=this.bounce,r.on_end=this.on_end,r.frame_direction=this.frame_direction,r.frames=this.frames.slice().slice(t,n),new e.Animation(r)},e.Animation.prototype.next=function(){return this.update(),this.frames[this.index]},e.Animation.prototype.atLastFrame=function(){return this.index==this.frames.length-1},e.Animation.prototype.atFirstFrame=function(){return this.index==0},e.Animation.prototype.currentFrame=function(){return this.frames[this.index]},e.Animation.prototype.toString=function(){return"[Animation, "+this.frames.length+" frames]"},e}(jaws||{}),jaws=function(e){return e.Viewport=function(n){if(!(this instanceof arguments.callee))return new arguments.callee(n);this.options=n,this.context=n.context||e.context,this.width=n.width||e.width,this.height=n.height||e.height,this.max_x=n.max_x||e.width,this.max_y=n.max_y||e.height,this.x=n.x||0,this.y=n.y||0;var r=this;this.move=function(e,t){e&&(this.x+=e),t&&(this.y+=t),this.verifyPosition()},this.moveTo=function(e,t){e!=undefined&&(this.x=e),t!=undefined&&(this.y=t),this.verifyPosition()},this.isOutside=function(e){return!r.isInside(e)},this.isInside=function(e){return e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height},this.isPartlyInside=function(e){var t=e.rect();return t.right>=r.x&&t.x<=r.x+r.width&&t.bottom>=r.y&&e.y<=r.y+r.height},this.isLeftOf=function(e){return e.x<r.x},this.isRightOf=function(e){return e.x>r.x+r.width},this.isAbove=function(e){return e.y<r.y},this.isBelow=function(e){return e.y>r.y+r.height},this.centerAround=function(e){this.x=e.x-this.width/2,this.y=e.y-this.height/2,this.verifyPosition()},this.forceInsideVisibleArea=function(t,n){t.x<this.x+n&&(t.x=this.x+n),t.x>this.x+e.width-n&&(t.x=this.x+e.width-n),t.y<this.y+n&&(t.y=this.y+n),t.y>this.y+e.height-n&&(t.y=this.y+e.height-n)},this.forceInside=function(e,t){e.x<t&&(e.x=t),e.x>this.max_x-t&&(e.x=this.max_x-t),e.y<t&&(e.y=t),e.y>this.max_y-t&&(e.y=this.max_y-t)},this.apply=function(e){this.context.save(),this.context.translate(-this.x,-this.y),e(),this.context.restore()},this.draw=function(e){this.apply(function(){e.forEach?e.forEach(r.drawIfPartlyInside):e.draw&&r.drawIfPartlyInside(e)})},this.drawTileMap=function(e){var t=e.atRect({x:this.x,y:this.y,right:this.x+this.width,bottom:this.y+this.height});this.apply(function(){for(var e=0;e<t.length;e++)t[e].draw()})},this.drawIfPartlyInside=function(e){r.isPartlyInside(e)&&e.draw()},this.verifyPosition=function(){var e=this.max_x-this.width;this.x<0&&(this.x=0),this.x>e&&(this.x=e);var e=this.max_y-this.height;this.y<0&&(this.y=0),this.y>e&&(this.y=e)},this.moveTo(n.x||0,n.y||0)},e.Viewport.prototype.toString=function(){return"[Viewport "+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width+", "+this.height+"]"},e}(jaws||{}),jaws=function(e){return e.TileMap=function(t){if(!(this instanceof arguments.callee))return new arguments.callee(t);this.cell_size=t.cell_size||[32,32],this.size=t.size||[100,100],this.sortFunction=t.sortFunction,this.cells=new Array(this.size[0]);for(var n=0;n<this.size[0];n++){this.cells[n]=new Array(this.size[1]);for(var r=0;r<this.size[1];r++)this.cells[n][r]=[]}},e.TileMap.prototype.clear=function(){for(var e=0;e<this.size[0];e++)for(var t=0;t<this.size[1];t++)this.cells[e][t]=[]},e.TileMap.prototype.sortCells=function(e){for(var t=0;t<this.size[0];t++)for(var n=0;n<this.size[1];n++)this.cells[t][n].sort(e)},e.TileMap.prototype.push=function(e){var t=this;if(e.forEach)return e.forEach(function(e){t.push(e)}),e;if(e.rect)return this.pushAsRect(e,e.rect());var n=parseInt(e.x/this.cell_size[0]),r=parseInt(e.y/this.cell_size[1]);return this.pushToCell(n,r,e)},e.TileMap.prototype.pushAsPoint=function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)this.pushAsPoint(e[t]);return e}var n=parseInt(e.x/this.cell_size[0]),r=parseInt(e.y/this.cell_size[1]);return this.pushToCell(n,r,e)},e.TileMap.prototype.pushAsRect=function(e,t){var n=parseInt(t.x/this.cell_size[0]),r=parseInt((t.right-1)/this.cell_size[0]);for(var i=n;i<=r;i++){var s=parseInt(t.y/this.cell_size[1]),o=parseInt((t.bottom-1)/this.cell_size[1]);for(var u=s;u<=o;u++)this.pushToCell(i,u,e)}return e},e.TileMap.prototype.pushToCell=function(e,t,n){return this.cells[e][t].push(n),this.sortFunction&&this.cells[e][t].sort(this.sortFunction),this},e.TileMap.prototype.at=function(e,t){var n=parseInt(e/this.cell_size[0]),r=parseInt(t/this.cell_size[1]);return this.cells[n][r]},e.TileMap.prototype.atRect=function(e){var t=[],n;try{var r=parseInt(e.x/this.cell_size[0]);r<0&&(r=0);var i=parseInt(e.right/this.cell_size[0]);i>=this.size[0]&&(i=this.size[0]-1);var s=parseInt(e.y/this.cell_size[1]);s<0&&(s=0);var o=parseInt(e.bottom/this.cell_size[1]);o>=this.size[1]&&(o=this.size[1]-1);for(var u=r;u<=i;u++)for(var a=s;a<=o;a++)this.cells[u][a].forEach(function(e,n){t.indexOf(e)==-1&&t.push(e)})}catch(f){}return t},e.TileMap.prototype.all=function(){var e=[];for(var t=0;t<this.size[0];t++)for(var n=0;n<this.size[1];n++)this.cells[t][n].forEach(function(t,n){e.push(t)});return e},e.TileMap.prototype.cell=function(e,t){return this.cells[e][t]},e.TileMap.prototype.toString=function(){return"[TileMap "+this.size[0]+" cols, "+this.size[1]+" rows]"},e}(jaws||{});typeof module!="undefined"&&"exports"in module&&(module.exports=jaws.TileMap);var jaws=function(e){function t(e,t){var n=function(t){return e.isSpriteList!==undefined?e.at(t):e[t]},r=[],i=new Array(t);for(var s=0;s<t;s++)i[s]=s;for(var s=t-1,o=e.length;0<=s;o=e.length){r.push(i.map(n));while(0<=s&&i[s]==o-1)s--,o--;if(0<=s){i[s]+=1;for(var u=s+1;u<t;u++)i[u]=i[u-1]+1;s=t-1}}return r}function n(e){return e&&e.length>0}return e.collideOneWithOne=function(t,n){return t.radius&&n.radius&&t!==n&&e.collideCircles(t,n)?!0:t.rect&&n.rect&&t!==n&&e.collideRects(t.rect(),n.rect())?!0:!1},e.collideOneWithMany=function(t,n){return n.filter(function(n){return e.collideOneWithOne(t,n)})},e.collideManyWithMany=function(n,r){var i=[];return n===r?t(n,2).forEach(function(t){e.collideOneWithOne(t[0],t[1])&&i.push([t[0],t[1]])}):n.forEach(function(t){r.forEach(function(n){e.collideOneWithOne(t,n)&&i.push([t,n])})}),i},e.collideCircles=function(t,n){return e.distanceBetween(t,n)<t.radius+n.radius},e.collideRects=function(e,t){return(e.x>=t.x&&e.x<=t.right||t.x>=e.x&&t.x<=e.right)&&(e.y>=t.y&&e.y<=t.bottom||t.y>=e.y&&t.y<=e.bottom)},e.distanceBetween=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e}(jaws||{}),jaws=function(e){return e.gfx={},e.gfx.retroScaleImage=function(t,n){var r=e.isImage(t)?e.imageToCanvas(t):t,i=r.getContext("2d"),s=i.getImageData(0,0,r.width,r.height).data,o=document.createElement("canvas");o.width=t.width*n,o.height=t.height*n;var u=o.getContext("2d"),a=u.createImageData(o.width,o.height),f=a.width,l=a.height;for(var c=0;c<l;c+=1){var h=Math.floor(c/n),p=c*a.width,d=h*t.width;for(var v=0;v<f;v+=1){var m=Math.floor(v/n),g=(p+v)*4,y=(d+m)*4;a.data[g]=s[y],a.data[g+1]=s[y+1],a.data[g+2]=s[y+2],a.data[g+3]=s[y+3]}}return u.putImageData(a,0,0),o},e}(jaws||{});return jaws}),function(e,t){function Et(e){return new St(e)}function St(e){if(e&&e.__wrapped__)return e;this.__wrapped__=e}function Dt(e,t,n){t||(t=0);var r=e.length,i=r-t>=(n||p),s=i?{}:e;if(i){var o,u=t-1;while(++u<r)o=e[u]+"",(_.call(s,o)?s[o]:s[o]=[]).push(e[u])}return function(e){if(i){var n=e+"";return _.call(s,n)&&$n(s[n],e)>-1}return $n(s,e,t)>-1}}function Pt(){var e,t,n,r=-1,i=arguments.length,s={bottom:"",exit:"",init:"",top:"",arrayBranch:{beforeLoop:""},objectBranch:{beforeLoop:""}};while(++r<i){e=arguments[r];for(t in e)n=(n=e[t])==null?"":n,/beforeLoop|inLoop/.test(t)?(typeof n=="string"&&(n={array:n,object:n}),s.arrayBranch[t]=n.array||"",s.objectBranch[t]=n.object||""):s[t]=n}var o=s.args,a=/^[^,]+/.exec(o)[0],f=s.useStrict;s.firstArg=a,s.hasDontEnumBug=nt,s.isKeysFast=ht,s.noArgsEnum=st,s.shadowed=C,s.useHas=s.useHas!==!1,s.useStrict=f==null?pt:f,s.noCharByIndex==null&&(s.noCharByIndex=at),s.exit||(s.exit="if (!"+a+") return result");if(a!="collection"||!s.arrayBranch.inLoop)s.arrayBranch=null;var l=Function("arrayLikeClasses, ArrayProto, bind, compareAscending, concat, forIn, hasOwnProperty, identity, indexOf, isArguments, isArray, isFunction, isPlainObject, iteratorBind, objectClass, objectTypes, nativeKeys, propertyIsEnumerable, slice, stringClass, toString","var callee = function("+o+") {\n"+xt(s)+"\n};\n"+"return callee");return l(vt,u,lr,Ht,M,en,_,Sr,$n,Xt,Vt,$t,Kt,It,G,bt,R,P,H,Z,B)}function Ht(e,n){var r=e.index,i=n.index;e=e.criteria,n=n.criteria;if(e!==n){if(e>n||e===t)return 1;if(e<n||n===t)return-1}return r<i?-1:1}function Bt(e,t){return O[t]}function jt(e){return"\\"+wt[e]}function Ft(e){return gt[e]}function It(e,t){return function(n,r,i){return e.call(t,n,r,i)}}function qt(){}function Rt(e,t){if(e&&v.test(t))return"<e%-"+t+"%>";var n=O.length;return O[n]="' +\n__e("+t+") +\n'",L+n+A}function Ut(e,t,n,r){if(r){var i=O.length;return O[i]="';\n"+r+";\n__p += '",L+i+A}return t?Rt(null,t):zt(null,n)}function zt(e,t){if(e&&v.test(t))return"<e%="+t+"%>";var n=O.length;return O[n]="' +\n((__t = ("+t+")) == null ? '' : __t) +\n'",L+n+A}function Wt(e){return yt[e]}function Xt(e){return B.call(e)==X}function $t(e){return typeof e=="function"}function Jt(e,t){var n=!1;if(!e||typeof e!="object"||!t&&Xt(e))return n;var r=e.constructor;return(!ft||typeof e.toString=="function"||typeof (e+"")!="string")&&(!$t(r)||r instanceof r)?it?(en(e,function(e,t,r){return n=!_.call(r,t),!1}),n===!1):(en(e,function(e,t){n=t}),n===!1||_.call(e,n)):n}function Gt(e,t,n,r){if(e==null)return e;n&&(t=!1),r||(r={thorough:null}),r.thorough==null&&(r.thorough=!!(a.clone||l.clone||c.clone));var i=bt[typeof e];if((i||r.thorough)&&e.clone&&$t(e.clone))return r.thorough=null,e.clone(t);if(i){var s=B.call(e);if(!mt[s]||ot&&Xt(e))return e;var o=s==V;i=o||(s==G?Kt(e,!0):i)}if(!i||!t)return i?o?H.call(e):Zt({},e):e;var u=e.constructor;switch(s){case $:return new u(e==1);case J:return new u(+e);case Q:case Z:return new u(e);case Y:return u(e.source,w.exec(e))}var f=r.clones||(r.clones=[]),h=r.sources||(r.sources=[]),p=f.length;while(p--)if(h[p]==e)return f[p];var d=o?u(p=e.length):{};f.push(d),h.push(e);if(o){var v=-1;while(++v<p)d[v]=Gt(e[v],t,null,r)}else tn(e,function(e,n){d[n]=Gt(e,t,null,r)});return d}function rn(e,t){return e?_.call(e,t):!1}function on(e){return e===!0||e===!1||B.call(e)==$}function un(e){return B.call(e)==J}function an(e){return e?e.nodeType===1:!1}function ln(e,t,n){if(e==null||t==null)return e===t;n||(n={thorough:null}),n.thorough==null&&(n.thorough=!!(a.isEqual||l.isEqual||c.isEqual));if(bt[typeof e]||bt[typeof t]||n.thorough){e=e.__wrapped__||e,t=t.__wrapped__||t;if(e.isEqual&&$t(e.isEqual))return n.thorough=null,e.isEqual(t);if(t.isEqual&&$t(t.isEqual))return n.thorough=null,t.isEqual(e)}if(e===t)return e!==0||1/e==1/t;var r=B.call(e);if(r!=B.call(t))return!1;switch(r){case $:case J:return+e==+t;case Q:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case Y:case Z:return e==t+""}var i=vt[r];if(ot&&!i&&(i=Xt(e))&&!Xt(t))return!1;if(!i&&(r!=G||ft&&(typeof e.toString!="function"&&typeof (e+"")=="string"||typeof t.toString!="function"&&typeof (t+"")=="string")))return!1;var s=n.stackA||(n.stackA=[]),o=n.stackB||(n.stackB=[]),u=s.length;while(u--)if(s[u]==e)return o[u]==t;var f=-1,h=!0,p=0;s.push(e),o.push(t);if(i){p=e.length,h=p==t.length;if(h)while(p--)if(!(h=ln(e[p],t[p],n)))break;return h}var d=e.constructor,v=t.constructor;if(d!=v&&!($t(d)&&d instanceof d&&$t(v)&&v instanceof v))return!1;for(var m in e)if(_.call(e,m)){p++;if(!_.call(t,m)||!ln(e[m],t[m],n))return!1}for(m in t)if(_.call(t,m)&&!(p--))return!1;if(nt)while(++f<7){m=C[f];if(_.call(e,m)&&(!_.call(t,m)||!ln(e[m],t[m],n)))return!1}return!0}function cn(e){return q(e)&&B.call(e)==Q}function hn(e){return e?bt[typeof e]:!1}function pn(e){return B.call(e)==Q&&e!=+e}function dn(e){return e===null}function vn(e){return B.call(e)==Q}function mn(e){return B.call(e)==Y}function gn(e){return B.call(e)==Z}function yn(e){return e===t}function Bn(e,t,n,r){if(!e)return n;var i=e.length,s=arguments.length<3;r&&(t=It(t,r));if(i>-1&&i===i>>>0){var o=at&&B.call(e)==Z?e.split(""):e;i&&s&&(n=o[--i]);while(i--)n=t(n,o[i],i,e);return n}var u,a=bn(e);i=a.length,i&&s&&(n=e[a[--i]]);while(i--)u=a[i],n=t(n,e[u],u,e);return n}function Fn(e){if(!e)return 0;var t=e.length;return t>-1&&t===t>>>0?t:bn(e).length}function Rn(e){if(!e)return[];if(e.toArray&&$t(e.toArray))return e.toArray();var t=e.length;return t>-1&&t===t>>>0?(ut?B.call(e)==Z:typeof e=="string")?e.split(""):H.call(e):Tn(e)}function zn(e){var t=[];if(!e)return t;var n=-1,r=e.length;while(++n<r)e[n]&&t.push(e[n]);return t}function Wn(e){var t=[];if(!e)return t;var n=-1,r=e.length,i=M.apply(t,arguments),s=Dt(i,r);while(++n<r)s(e[n])||t.push(e[n]);return t}function Xn(e,t,n){if(e)return t==null||n?e[0]:H.call(e,0,t)}function Vn(e,t){var n=[];if(!e)return n;var r,i=-1,s=e.length;while(++i<s)r=e[i],Vt(r)?D.apply(n,t?r:Vn(r)):n.push(r);return n}function $n(e,t,n){if(!e)return-1;var r=-1,i=e.length;if(n){if(typeof n!="number")return r=ir(e,t),e[r]===t?r:-1;r=(n<0?U(0,i+n):n)-1}while(++r<i)if(e[r]===t)return r;return-1}function Jn(e,t,n){return e?H.call(e,0,-(t==null||n?1:t)):[]}function Kn(e){var t=[];if(!e)return t;var n,r=arguments.length,i=[],s=-1,o=e.length;e:while(++s<o){n=e[s];if($n(t,n)<0){for(var u=1;u<r;u++)if(!(i[u]||(i[u]=Dt(arguments[u])))(n))continue e;t.push(n)}}return t}function Qn(e,t,n){if(e){var r=e.length;return t==null||n?e[r-1]:H.call(e,-t||r)}}function Gn(e,t,n){if(!e)return-1;var r=e.length;n&&typeof n=="number"&&(r=(n<0?U(0,r+n):z(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function Yn(e,t,n){var r=-Infinity,i=r;if(!e)return i;var s,o=-1,u=e.length;if(!t){while(++o<u)e[o]>i&&(i=e[o]);return i}n&&(t=It(t,n));while(++o<u)s=t(e[o],o,e),s>r&&(r=s,i=e[o]);return i}function Zn(e,t,n){var r=Infinity,i=r;if(!e)return i;var s,o=-1,u=e.length;if(!t){while(++o<u)e[o]<i&&(i=e[o]);return i}n&&(t=It(t,n));while(++o<u)s=t(e[o],o,e),s<r&&(r=s,i=e[o]);return i}function er(e,t){if(!e)return{};var n=-1,r=e.length,i={};while(++n<r)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i}function tr(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var r=-1,i=U(0,Math.ceil((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s}function nr(e,t,n){return e?H.call(e,t==null||n?1:t):[]}function rr(e){if(!e)return[];var t,n=-1,r=e.length,i=Array(r);while(++n<r)t=F(W()*(n+1)),i[n]=i[t],i[t]=e[n];return i}function ir(e,t,n,r){if(!e)return 0;var i,s=0,o=e.length;if(n){r&&(n=lr(n,r)),t=n(t);while(s<o)i=s+o>>>1,n(e[i])<t?s=i+1:o=i}else while(s<o)i=s+o>>>1,e[i]<t?s=i+1:o=i;return s}function sr(){var e=-1,t=[],n=M.apply(t,arguments),r=n.length;while(++e<r)$n(t,n[e])<0&&t.push(n[e]);return t}function or(e,t,n,r){var i=[];if(!e)return i;var s,o=-1,u=e.length,a=[];typeof t=="function"&&(r=n,n=t,t=!1),n?r&&(n=It(n,r)):n=Sr;while(++o<u){s=n(e[o],o,e);if(t?!o||a[a.length-1]!==s:$n(a,s)<0)a.push(s),i.push(e[o])}return i}function ur(e){var t=[];if(!e)return t;var n=-1,r=e.length,i=Dt(arguments,1,20);while(++n<r)i(e[n])||t.push(e[n]);return t}function ar(e){if(!e)return[];var t=-1,n=Yn(Pn(arguments,"length")),r=Array(n);while(++t<n)r[t]=Pn(arguments,t);return r}function fr(e,t){return e<1?t():function(){if(--e<1)return t.apply(this,arguments)}}function lr(e,t){function s(){var o=arguments,u=t;r||(e=t[n]),i.length&&(o=o.length?i.concat(H.call(o)):i);if(this instanceof s){qt.prototype=e.prototype,u=new qt;var a=e.apply(u,o);return a&&bt[typeof a]?a:u}return e.apply(u,o)}var n,r=$t(e);if(!r)n=t,t=e;else if(ct||j&&arguments.length>2)return j.call.apply(j,arguments);var i=H.call(arguments,2);return s}function hr(){var e=arguments;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function pr(e,t,n){function u(){o=null,n||(i=e.apply(s,r))}var r,i,s,o;return function(){var a=n&&!o;return r=arguments,s=this,et(o),o=tt(u,t),a&&(i=e.apply(s,r)),i}}function dr(e,n){var r=H.call(arguments,2);return tt(function(){return e.apply(t,r)},n)}function vr(e){var n=H.call(arguments,1);return tt(function(){return e.apply(t,n)},1)}function mr(e,t){var n={};return function(){var r=t?t.apply(this,arguments):arguments[0];return _.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}}function gr(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}function yr(e){var t=H.call(arguments,1),n=t.length;return function(){var r,i=arguments;return i.length&&(t.length=n,D.apply(t,i)),r=t.length==1?e.call(this,t[0]):e.apply(this,t),t.length=n,r}}function br(e,t){function u(){o=new Date,s=null,r=e.apply(i,n)}var n,r,i,s,o=0;return function(){var a=new Date,f=t-(a-o);return n=arguments,i=this,f<=0?(o=a,r=e.apply(i,n)):s||(s=tt(u,f)),r}}function wr(e,t){return function(){var n=[e];return arguments.length&&D.apply(n,arguments),t.apply(this,n)}}function Er(e){return e==null?"":(e+"").replace(T,Ft)}function Sr(e){return e}function xr(e){On(nn(e),function(t){var n=Et[t]=e[t];St.prototype[t]=function(){var e=[this.__wrapped__];arguments.length&&D.apply(e,arguments);var t=n.apply(Et,e);return this.__chain__&&(t=new St(t),t.__chain__=!0),t}})}function Tr(){return e._=d,this}function Nr(e,t){return e==null&&t==null?W():(e=+e||0,t==null&&(t=e,e=0),e+F(W()*((+t||0)-e+1)))}function Cr(e,t){if(!e)return null;var n=e[t];return $t(n)?e[t]():n}function kr(e,t,o){o||(o={}),e+="";var u,a,f=o.escape,l=o.evaluate,c=o.interpolate,h=Et.templateSettings,p=o.variable||h.variable,d=p;f==null&&(f=h.escape),l==null&&(l=h.evaluate||!1),c==null&&(c=h.interpolate),f&&(e=e.replace(f,Rt)),c&&(e=e.replace(c,zt)),l!=n&&(n=l,s=RegExp("<e%-([\\s\\S]+?)%>|<e%=([\\s\\S]+?)%>"+(l?"|"+l.source:""),"g")),u=O.length,e=e.replace(s,Ut),u=u!=O.length,e="__p += '"+e.replace(N,jt).replace(x,Bt)+"';\n",O.length=0,d||(p=r||"obj",u?e="with ("+p+") {\n"+e+"\n}\n":(p!=r&&(r=p,i=RegExp("(\\(\\s*)"+p+"\\."+p+"\\b","g")),e=e.replace(E,"$&"+p+".").replace(i,"$1__d"))),e=(u?e.replace(g,""):e).replace(y,"$1").replace(b,"$1;"),e="function("+p+") {\n"+(d?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(u?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":(d?"":", __d = "+p+"."+p+" || "+p)+";\n")+e+"return __p\n}",dt&&(e+="\n//@ sourceURL=/lodash/template/source["+k++ +"]");try{a=Function("_","return "+e)(Et)}catch(v){throw v.source=e,v}return t?a(t):(a.source=e,a)}function Lr(e,t,n){var r=-1;if(n)while(++r<e)t.call(n,r);else while(++r<e)t(r)}function Ar(e){return e==null?"":(e+"").replace(m,Wt)}function Or(e){var t=h++;return e?e+t:t}function Mr(e){return e=new St(e),e.__chain__=!0,e}function _r(e,t){return t(e),e}function Dr(){return this.__chain__=!0,this}function Pr(){return this.__wrapped__}var n,r,i,s,o=typeof exports=="object"&&exports&&(typeof global=="object"&&global&&global==global.global&&(e=global),exports),u=Array.prototype,a=Boolean.prototype,f=Object.prototype,l=Number.prototype,c=String.prototype,h=0,p=30,d=e._,v=/[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/,m=/&(?:amp|lt|gt|quot|#x27);/g,g=/\b__p \+= '';/g,y=/\b(__p \+=) '' \+/g,b=/(__e\(.*?\)|\b__t\)) \+\n'';/g,w=/\w*$/,E=/(?:__e|__t = )\(\s*(?![\d\s"']|this\.)/g,S=RegExp("^"+(f.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),x=/__token(\d+)__/g,T=/[&<>"']/g,N=/['\n\r\t\u2028\u2029\\]/g,C=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],k=0,L="__token",A="__",O=[],M=u.concat,_=f.hasOwnProperty,D=u.push,P=f.propertyIsEnumerable,H=u.slice,B=f.toString,j=S.test(j=H.bind)&&j,F=Math.floor,I=S.test(I=Array.isArray)&&I,q=e.isFinite,R=S.test(R=Object.keys)&&R,U=Math.max,z=Math.min,W=Math.random,X="[object Arguments]",V="[object Array]",$="[object Boolean]",J="[object Date]",K="[object Function]",Q="[object Number]",G="[object Object]",Y="[object RegExp]",Z="[object String]",et=e.clearTimeout,tt=e.setTimeout,nt,rt,it,st=!0;(function(){function n(){this.x=1}var e={0:1,length:1},t=[];n.prototype={valueOf:1,y:1};for(var r in new n)t.push(r);for(r in arguments)st=!r;nt=(t+"").length<4,it=t[0]!="x",rt=(t.splice.call(e,0,1),e[0])})(1);var ot=!Xt(arguments),ut=H.call("x")[0]!="x",at="x"[0]+Object("x")[0]!="xx";try{var ft=({toString:0}+"",B.call(e.document||0)==G)}catch(lt){}var ct=j&&/\n|Opera/.test(j+B.call(e.opera)),ht=R&&/^.+$|true/.test(R+!!e.attachEvent),pt=!ct;try{var dt=(Function("//@")(),!e.attachEvent)}catch(lt){}var vt={};vt[$]=vt[J]=vt[K]=vt[Q]=vt[G]=vt[Y]=!1,vt[X]=vt[V]=vt[Z]=!0;var mt={};mt[X]=mt[K]=!1,mt[V]=mt[$]=mt[J]=mt[Q]=mt[G]=mt[Y]=mt[Z]=!0;var gt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},yt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"},bt={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1,unknown:!0},wt={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};Et.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:""};var xt=kr("<% if (useStrict) { %>'use strict';\n<% } %>var index, value, iteratee = <%= firstArg %>, result<% if (init) { %> = <%= init %><% } %>;\n<%= exit %>;\n<%= top %>;\n<% if (arrayBranch) { %>var length = iteratee.length; index = -1;  <% if (objectBranch) { %>\nif (length > -1 && length === length >>> 0) {<% } %>  <% if (noCharByIndex) { %>\n  if (toString.call(iteratee) == stringClass) {\n    iteratee = iteratee.split('')\n  }  <% } %>\n  <%= arrayBranch.beforeLoop %>;\n  while (++index < length) {\n    value = iteratee[index];\n    <%= arrayBranch.inLoop %>\n  }  <% if (objectBranch) { %>\n}<% } %><% } %><% if (objectBranch) { %>  <% if (arrayBranch) { %>\nelse {  <%  } else if (noArgsEnum) { %>\n  var length = iteratee.length; index = -1;\n  if (length && isArguments(iteratee)) {\n    while (++index < length) {\n      value = iteratee[index += ''];\n      <%= objectBranch.inLoop %>\n    }\n  } else {  <% } %>  <% if (!hasDontEnumBug) { %>\n  var skipProto = typeof iteratee == 'function' && \n    propertyIsEnumerable.call(iteratee, 'prototype');\n  <% } %>  <% if (isKeysFast && useHas) { %>\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iteratee] ? nativeKeys(iteratee) : [],\n      length = ownProps.length;\n\n  <%= objectBranch.beforeLoop %>;\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    <% if (!hasDontEnumBug) { %>if (!(skipProto && index == 'prototype')) {\n  <% } %>    value = iteratee[index];\n    <%= objectBranch.inLoop %>\n    <% if (!hasDontEnumBug) { %>}\n<% } %>  }  <% } else { %>\n  <%= objectBranch.beforeLoop %>;\n  for (index in iteratee) {<%    if (!hasDontEnumBug || useHas) { %>\n    if (<%      if (!hasDontEnumBug) { %>!(skipProto && index == 'prototype')<% }      if (!hasDontEnumBug && useHas) { %> && <% }      if (useHas) { %>hasOwnProperty.call(iteratee, index)<% }    %>) {    <% } %>\n    value = iteratee[index];\n    <%= objectBranch.inLoop %>;\n    <% if (!hasDontEnumBug || useHas) { %>}\n<% } %>  }  <% } %>  <% if (hasDontEnumBug) { %>\n\n  var ctor = iteratee.constructor;\n    <% for (var k = 0; k < 7; k++) { %>\n  index = '<%= shadowed[k] %>';\n  if (<%      if (shadowed[k] == 'constructor') {        %>!(ctor && ctor.prototype === iteratee) && <%      } %>hasOwnProperty.call(iteratee, index)) {\n    value = iteratee[index];\n    <%= objectBranch.inLoop %>\n  }    <% } %>  <% } %>  <% if (arrayBranch || noArgsEnum) { %>\n}<% } %><% } %>\n<%= bottom %>;\nreturn result"),Tt={args:"collection, callback, thisArg",init:"collection",top:"if (!callback) {\n  callback = identity\n}\nelse if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"if (callback(value, index, collection) === false) return result"},Nt={init:"{}",top:"var prop;\nif (typeof callback != 'function') {\n  var valueProp = callback;\n  callback = function(value) { return value[valueProp] }\n}\nelse if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"prop = callback(value, index, collection);\n(hasOwnProperty.call(result, prop) ? result[prop]++ : result[prop] = 1)"},Ct={init:"true",inLoop:"if (!callback(value, index, collection)) return !result"},kt={useHas:!1,useStrict:!1,args:"object",init:"object",top:"for (var argsIndex = 1, argsLength = arguments.length; argsIndex < argsLength; argsIndex++) {\n  if (iteratee = arguments[argsIndex]) {",inLoop:"result[index] = value",bottom:"  }\n}"},Lt={init:"[]",inLoop:"callback(value, index, collection) && result.push(value)"},At={top:"if (thisArg) callback = iteratorBind(callback, thisArg)"},Ot={inLoop:{object:Tt.inLoop}},Mt={init:"",exit:"if (!collection) return []",beforeLoop:{array:"result = Array(length)",object:"result = "+(ht?"Array(length)":"[]")},inLoop:{array:"result[index] = callback(value, index, collection)",object:"result"+(ht?"[ownIndex] = ":".push")+"(callback(value, index, collection))"}},_t={useHas:!1,args:"object, callback, thisArg",init:"{}",top:"var isFunc = typeof callback == 'function';\nif (!isFunc) {\n  var props = concat.apply(ArrayProto, arguments)\n} else if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"if (isFunc\n  ? !callback(value, index, object)\n  : indexOf(props, index) < 0\n) result[index] = value"};ot&&(Xt=function(e){return!!e&&!!_.call(e,"callee")});var Vt=I||function(e){return B.call(e)==V};$t(/x/)&&($t=function(e){return B.call(e)==K});var Kt=bt.__proto__!=f?Jt:function(e,t){if(!e)return!1;var n=e.valueOf,r=typeof n=="function"&&(r=n.__proto__)&&r.__proto__;return r?e==r||e.__proto__==r&&(t||!Xt(e)):Jt(e)},Qt=Pt({args:"object",init:"[]",inLoop:"result.push(index)"}),Yt=Pt(kt,{inLoop:"if (result[index] == null) "+kt.inLoop}),Zt=Pt(kt),en=Pt(Tt,At,Ot,{useHas:!1}),tn=Pt(Tt,At,Ot),nn=Pt({useHas:!1,args:"object",init:"[]",inLoop:"if (isFunction(value)) result.push(index)",bottom:"result.sort()"}),sn=Pt({args:"object",init:"{}",inLoop:"result[value] = index"}),fn=Pt({args:"value",init:"true",top:"var className = toString.call(value),\n    length = value.length;\nif (arrayLikeClasses[className]"+(ot?" || isArguments(value)":"")+" ||\n"+"  (className == objectClass && length > -1 && length === length >>> 0 &&\n"+"  isFunction(value.splice))"+") return !length",inLoop:{object:"return false"}}),bn=R?function(e){var t=typeof e;return t=="function"&&P.call(e,"prototype")?Qt(e):e&&bt[t]?R(e):[]}:Qt,wn=Pt(kt,{args:"object, source, indicator",top:"var isArr, recursive = indicator == isPlainObject,\n    data = recursive ? arguments[3] : { values: [], sources: [] };\nfor (var argsIndex = 1, argsLength = recursive ? 2 : arguments.length; argsIndex < argsLength; argsIndex++) {\n  if (iteratee = arguments[argsIndex]) {",inLoop:"if ((source = value) && ((isArr = isArray(source)) || isPlainObject(source))) {\n  var found = false, values = data.values, sources = data.sources, stackLength = sources.length;\n  while (stackLength--) {\n    if (found = sources[stackLength] == source) break\n  }\n  if (found) {\n    result[index] = values[stackLength]\n  } else {\n    values.push(value = (value = result[index]) && isArr\n      ? (isArray(value) ? value : [])\n      : (isPlainObject(value) ? value : {})\n    );\n    sources.push(source);\n    result[index] = callee(value, source, isPlainObject, data)\n  }\n} else if (source != null) {\n  result[index] = source\n}"}),En=Pt(_t),Sn=Pt({args:"object",init:"[]",inLoop:"result"+(ht?"[ownIndex] = ":".push")+"([index, value])"}),xn=Pt(_t,{top:"if (typeof callback != 'function') {\n  var prop,\n      props = concat.apply(ArrayProto, arguments),\n      length = props.length;\n  for (index = 1; index < length; index++) {\n    prop = props[index];\n    if (prop in object) result[prop] = object[prop]\n  }\n} else {\n  if (thisArg) callback = iteratorBind(callback, thisArg)",inLoop:"if (callback(value, index, object)) result[index] = value",bottom:"}"}),Tn=Pt({args:"object",init:"[]",inLoop:"result.push(value)"}),Nn=Pt({args:"collection, target",init:"false",noCharByIndex:!1,beforeLoop:{array:"if (toString.call(collection) == stringClass) return collection.indexOf(target) > -1"},inLoop:"if (value === target) return true"}),Cn=Pt(Tt,Nt),kn=Pt(Tt,Ct),Ln=Pt(Tt,Lt),An=Pt(Tt,At,{init:"",inLoop:"if (callback(value, index, collection)) return value"}),On=Pt(Tt,At),Mn=Pt(Tt,Nt,{inLoop:"prop = callback(value, index, collection);\n(hasOwnProperty.call(result, prop) ? result[prop] : result[prop] = []).push(value)"}),_n=Pt(Mt,{args:"collection, methodName",top:"var args = slice.call(arguments, 2),\n    isFunc = typeof methodName == 'function'",inLoop:{array:"result[index] = (isFunc ? methodName : value[methodName]).apply(value, args)",object:"result"+(ht?"[ownIndex] = ":".push")+"((isFunc ? methodName : value[methodName]).apply(value, args))"}}),Dn=Pt(Tt,Mt),Pn=Pt(Mt,{args:"collection, property",inLoop:{array:"result[index] = value[property]",object:"result"+(ht?"[ownIndex] = ":".push")+"(value[property])"}}),Hn=Pt({args:"collection, callback, accumulator, thisArg",init:"accumulator",top:"var noaccum = arguments.length < 3;\nif (thisArg) callback = iteratorBind(callback, thisArg)",beforeLoop:{array:"if (noaccum) result = iteratee[++index]"},inLoop:{array:"result = callback(result, value, index, collection)",object:"result = noaccum\n  ? (noaccum = false, value)\n  : callback(result, value, index, collection)"}}),jn=Pt(Tt,Lt,{inLoop:"!"+Lt.inLoop}),In=Pt(Tt,Ct,{init:"false",inLoop:Ct.inLoop.replace("!","")}),qn=Pt(Tt,Nt,Mt,{inLoop:{array:"result[index] = {\n  criteria: callback(value, index, collection),\n  index: index,\n  value: value\n}",object:"result"+(ht?"[ownIndex] = ":".push")+"({\n"+"  criteria: callback(value, index, collection),\n"+"  index: index,\n"+"  value: value\n"+"})"},bottom:"result.sort(compareAscending);\nlength = result.length;\nwhile (length--) {\n  result[length] = result[length].value\n}"}),Un=Pt(Lt,{args:"collection, properties",top:"var props = [];\nforIn(properties, function(value, prop) { props.push(prop) });\nvar propsLength = props.length",inLoop:"for (var prop, pass = true, propIndex = 0; propIndex < propsLength; propIndex++) {\n  prop = props[propIndex];\n  if (!(pass = value[prop] === properties[prop])) break\n}\npass && result.push(value)"}),cr=Pt({useHas:!1,useStrict:!1,args:"object",init:"object",top:"var funcs = arguments,\n    length = funcs.length;\nif (length > 1) {\n  for (var index = 1; index < length; index++) {\n    result[funcs[index]] = bind(result[funcs[index]], result)\n  }\n  return result\n}",inLoop:"if (isFunction(result[index])) {\n  result[index] = bind(result[index], result)\n}"});Et.VERSION="0.7.0",Et.after=fr,Et.bind=lr,Et.bindAll=cr,Et.chain=Mr,Et.clone=Gt,Et.compact=zn,Et.compose=hr,Et.contains=Nn,Et.countBy=Cn,Et.debounce=pr,Et.defaults=Yt,Et.defer=vr,Et.delay=dr,Et.difference=Wn,Et.escape=Er,Et.every=kn,Et.extend=Zt,Et.filter=Ln,Et.find=An,Et.first=Xn,Et.flatten=Vn,Et.forEach=On,Et.forIn=en,Et.forOwn=tn,Et.functions=nn,Et.groupBy=Mn,Et.has=rn,Et.identity=Sr,Et.indexOf=$n,Et.initial=Jn,Et.intersection=Kn,Et.invert=sn,Et.invoke=_n,Et.isArguments=Xt,Et.isArray=Vt,Et.isBoolean=on,Et.isDate=un,Et.isElement=an,Et.isEmpty=fn,Et.isEqual=ln,Et.isFinite=cn,Et.isFunction=$t,Et.isNaN=pn,Et.isNull=dn,Et.isNumber=vn,Et.isObject=hn,Et.isRegExp=mn,Et.isString=gn,Et.isUndefined=yn,Et.keys=bn,Et.last=Qn,Et.lastIndexOf=Gn,Et.map=Dn,Et.max=Yn,Et.memoize=mr,Et.merge=wn,Et.min=Zn,Et.mixin=xr,Et.noConflict=Tr,Et.object=er,Et.omit=En,Et.once=gr,Et.pairs=Sn,Et.partial=yr,Et.pick=xn,Et.pluck=Pn,Et.random=Nr,Et.range=tr,Et.reduce=Hn,Et.reduceRight=Bn,Et.reject=jn,Et.rest=nr,Et.result=Cr,Et.shuffle=rr,Et.size=Fn,Et.some=In,Et.sortBy=qn,Et.sortedIndex=ir,Et.tap=_r,Et.template=kr,Et.throttle=br,Et.times=Lr,Et.toArray=Rn,Et.unescape=Ar,Et.union=sr,Et.uniq=or,Et.uniqueId=Or,Et.values=Tn,Et.where=Un,Et.without=ur,Et.wrap=wr,Et.zip=ar,Et.all=kn,Et.any=In,Et.collect=Dn,Et.detect=An,Et.drop=nr,Et.each=On,Et.foldl=Hn,Et.foldr=Bn,Et.head=Xn,Et.include=Nn,Et.inject=Hn,Et.methods=nn,Et.select=Ln,Et.tail=nr,Et.take=Xn,Et.unique=or,Et._iteratorTemplate=xt,Et._shimKeys=Qt,St.prototype=Et.prototype,xr(Et),St.prototype.chain=Dr,St.prototype.value=Pr,On(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=u[e];St.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),rt&&e.length===0&&delete e[0],this.__chain__&&(e=new St(e),e.__chain__=!0),e}}),On(["concat","join","slice"],function(e){var t=u[e];St.prototype[e]=function(){var e=this.__wrapped__,n=t.apply(e,arguments);return this.__chain__&&(n=new St(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=Et,define("lodash",[],function(){return Et})):o?typeof module=="object"&&module&&module.exports==o?(module.exports=Et)._=Et:o._=Et:e._=Et}(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("Sprite",["jaws"],function(e){var n;return n=function(n){function r(e){r.__super__.constructor.call(this,e)}return t(r,n),r.prototype.jaws=e,r.prototype.moveLeft=function(){return this.x-=this.speed},r.prototype.moveRight=function(){return this.x+=this.speed},r.prototype.moveUp=function(){return this.y-=this.speed},r.prototype.moveDown=function(){return this.y+=this.speed},r.prototype.stop=function(){return this.speed=0},r}(e.Sprite)})}.call(this),function(){define("SpeedPass",{speeds:function(){var e;return e=6,{ship:e,planet:e/2,star:e/3}}(),getSpeed:function(e){return this.speeds[e]}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("Ship",["Sprite","SpeedPass"],function(e,n){var r;return r=function(e){function r(e){this.speed=n.getSpeed("ship"),r.__super__.constructor.call(this,{image:"img/rocket.png",x:e.x,y:e.y})}return t(r,e),r}(e)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("Planet",["lodash","Sprite","SpeedPass"],function(e,n,r){var i;return i=function(i){function s(t){var i;this.viewport=t,i={x:e.random(0,n.prototype.jaws.width),y:0},this.speed=r.getSpeed("planet"),s.__super__.constructor.call(this,{image:"img/planet.png",x:i.x,y:i.y}),this.scale(e.random(75,100)/100)}return t(s,i),s}(n)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("Star",["lodash","Sprite","SpeedPass"],function(e,n,r){var i;return i=function(i){function s(t){var i,o,u,a;this.viewport=t,i={x:e.random(0,n.prototype.jaws.width),y:0},o=e.random(1,30),a=o/30,u=o/50,this.speed=r.getSpeed("planet")/(o/10),s.__super__.constructor.call(this,{image:"img/star.png",x:i.x,y:i.y,alpha:u}),this.scale(a)}return t(s,i),s}(n)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("GameEngine",["lodash","jaws","Ship","Planet","Star"],function(t,n,r,i,s){var o;return o=function(){function o(){this.checkForCollisions=e(this.checkForCollisions,this),this.isOutside=e(this.isOutside,this)}return o.prototype.setup=function(){return n.preventDefaultKeys(["left","right","up","down","space"]),this.difficulty=0,this.levelUp=0,this.score=0,this.howManyPlanets=0,this.scoreView=document.getElementById("score"),this.viewport=new n.Viewport({max_x:n.width,max_y:n.height}),this.ship=new r({x:n.width/2,y:n.height-225}),this.planets=new n.SpriteList,this.stars=new n.SpriteList},o.prototype.update=function(){var e;return e=t.random(0,100),this.handlePlayerInput(),this.createEnemies(e),this.createStars(e),this.moveThings(),this.checkForCollisions()},o.prototype.draw=function(){return n.context.clearRect(0,0,n.width,n.height),this.ship.draw(),this.planets.draw(),this.stars.draw()},o.prototype.handlePlayerInput=function(){n.pressed("left")&&this.ship.moveLeft();if(n.pressed("right"))return this.ship.moveRight()},o.prototype.createEnemies=function(e){var t;if(0<=e&&e<=this.difficulty)return++this.levelUp,++this.howManyPlanets,this.levelUp===5&&(this.levelUp=0,++this.difficulty),t=new i(this.viewport),this.viewport.forceInsideVisibleArea(t,1),this.planets.push(t),this.scoreView.innerHTML=this.howManyPlanets*(this.difficulty+1)},o.prototype.createStars=function(e){var t;if(75<e&&e<100)return t=new s(this.viewport),this.viewport.forceInsideVisibleArea(t,1),this.stars.push(t)},o.prototype.moveThings=function(){return this.planets.forEach(function(e){return e.moveDown()}),this.planets.removeIf(this.isOutside),this.stars.forEach(function(e){return e.moveDown()}),this.stars.removeIf(this.isOutside)},o.prototype.isOutside=function(e){return this.viewport.isOutside(e)},o.prototype.checkForCollisions=function(){var e=this;return n.collideOneWithMany(this.ship,this.planets).forEach(function(t){return t.stop(),e.ship.stop(),n.switchGameState({setup:n.context.clearRect(0,0,n.width,n.height)}),alert("GameOver")})},o}()})}.call(this),function(){require.config({shim:{lodash:{exports:"_"}},paths:{lodash:"../vendor/lodash.0.7.0",jaws:"../vendor/jaws"}}),require(["jaws","GameEngine"],function(e,t){return window.onload=function(){return e.width=1e3,e.assets.add("img/planet.png"),e.assets.add("img/rocket.png"),e.assets.add("img/star.png"),e.start(t,{width:window.innerWidth,height:window.innerHeight})}})}.call(this),define("main",[],function(){})